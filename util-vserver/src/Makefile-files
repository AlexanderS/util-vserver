## $Id$  -*- makefile -*-

## Copyright (C) 2003 Enrico Scholz <enrico.scholz@informatik.tu-chemnitz.de>
##  
## This program is free software; you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation; either version 2, or (at your option)
## any later version.
##  
## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
##  
## You should have received a copy of the GNU General Public License
## along with this program; if not, write to the Free Software
## Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
##  

src_sbin_CXX_X_PROGS	=  src/vfiles
src_pkglib_CXX_X_PROGS	=  src/vunify src/vbuild src/vcheck

src_OPTIONS_EXEMPT	=  src/parserpmdump \
			   src/readlink \
			   src/showattr \
			   src/showperm \
			   src/vbuild \
			   src/vcheck \
			   src/vreboot \
			   src/save_ctxinfo \
			   src/vunify \
			   src/mask2prefix \
			   src/pipe-sync \
			   src/rpm-fake.so \
			   src/capchroot \
			   src/chroot-cat \
			   src/chroot-rm \
			   src/filetime \
			   src/ifspec \
			   src/chbind \
			   src/chcontext \
			   src/rebootmgr \
			   src/reducecap \
			   src/vlimit \
			   src/vdu \
			   src/vfiles \
			   src/vserver-stat



src_DIETPROGS		=  src/new-namespace \
	     		   src/secure-mount \
	     		   src/secure-umount \
	     		   src/save_ctxinfo \
	     		   src/mask2prefix \
	     		   src/chroot-rm \
	     		   src/chroot-cat \
	     		   src/fakerunlevel \
			   src/pipe-sync \
			   src/exec-ulimit \
			   src/vlimit \
	     		   src/ctx-kill

src_HDRS		=  src/vutil.h src/vutil.p src/util.h \
			   src/wrappers.h src/wrappers-vserver.h \
			   src/ext2fs.h \
			   src/compat-pivot_root.h \
			   src/stack-start.h \
			   src/vserver.hh

src_pkglib_SCRPTS	=  src/setattr
src_pkglib_PRGS		=  src/capchroot \
	     		   src/chroot-cat \
			   src/chroot-rm \
			   src/fakerunlevel \
			   src/filetime \
			   src/ifspec \
			   src/listdevip \
			   src/parserpmdump \
			   src/readlink \
			   src/showattr \
			   src/showperm \
			   src/vreboot \
			   src/save_ctxinfo \
			   src/secure-mount \
			   src/secure-umount \
			   src/mask2prefix \
			   src/pipe-sync \
			   src/exec-ulimit \
			   src/rpm-fake.so \
			   $(src_pkglib_CXX_PROGS)

src_sbin_PRGS		=  src/chbind \
			   src/chcontext \
			   src/ctx-kill \
			   src/rebootmgr \
			   src/reducecap \
			   src/vdu \
			   src/new-namespace \
			   src/vlimit \
			   src/vserver-stat \
			   $(src_sbin_CXX_PROGS)

src_capchroot_SOURCES		=  src/capchroot.c
src_capchroot_LDADD		=  lib/libvserver.a

src_chbind_SOURCES		=  src/chbind.c
src_chbind_LDADD		=  lib/libvserver.a

src_chcontext_SOURCES		=  src/chcontext.c
src_chcontext_LDADD		=  lib/libvserver.a

src_chroot_rm_SOURCES		=  src/chroot-rm.c
src_chroot_cat_SOURCES		=  src/chroot-cat.c
src_fakerunlevel_SOURCES	=  src/fakerunlevel.c
src_filetime_SOURCES		=  src/filetime.c
src_ifspec_SOURCES		=  src/ifspec.c
src_listdevip_SOURCES		=  src/listdevip.c
src_parserpmdump_SOURCES	=  src/parserpmdump.c
src_readlink_SOURCES		=  src/readlink.c
src_rebootmgr_SOURCES		=  src/rebootmgr.c
src_pipe_sync_SOURCES		=  src/pipe-sync.c
src_exec_ulimit_SOURCES		=  src/exec-ulimit.c

src_reducecap_SOURCES		=  src/reducecap.c
src_reducecap_LDADD		=  lib/libvserver.a

src_vlimit_SOURCES		=  src/vlimit.c
src_vlimit_LDADD		=  lib/libvserver.a

src_save_ctxinfo_SOURCES	=  src/save_ctxinfo.c
src_save_ctxinfo_LDADD		=  lib/libvserver.a

src_showattr_SOURCES		=  src/showattr.c
src_showperm_SOURCES		=  src/showperm.c
src_vdu_SOURCES			=  src/vdu.c
src_vreboot_SOURCES		=  src/vreboot.c
src_new_namespace_SOURCES	=  src/new-namespace.c
src_secure_mount_SOURCES	=  src/secure-mount.c
src_secure_umount_SOURCES	=  src/secure-umount.c

src_mask2prefix_SOURCES		=  src/mask2prefix.c

src_ctx_kill_SOURCES		=  src/ctx-kill.c
src_ctx_kill_LDADD		=  lib/libvserver.a

src_vserver_stat_SOURCES	=  src/vserver-stat.c
src_vserver_stat_LDADD		=  lib/libvserver.a

src_vfiles_SOURCES		=  src/vfiles.cc src/vutil.cc src/vserver.cc
src_vbuild_SOURCES		=  src/vbuild.cc src/vutil.cc src/vserver.cc
src_vunify_SOURCES		=  src/vunify.cc src/vutil.cc src/vserver.cc
src_vcheck_SOURCES		=  src/vcheck.cc src/vutil.cc src/vserver.cc


src_rpm_fake_so_SOURCES		=  src/rpm-fake.c $(src_rpm_fake_so_XSRCS)
src_rpm_fake_so_CFLAGS		=  $(AM_CFLAGS) -fPIC
src_rpm_fake_so_CPPFLAGS	=  $(AM_CPPFLAGS) -DPIC
src_rpm_fake_so_LDFLAGS		=  -fPIC -shared
src_rpm_fake_so_LDADD		=  $(src_rpm_fake_so_XLIBS) -ldl


EXTRA_src_rpm_fake_so_SOURCES	=  $(lib_SRCS)
if ENSC_ALLOW_FPIC_WITH_SYSCALL
src_rpm_fake_so_XSRCS		=  $(lib_SRCS)
src_rpm_fake_so_XLIBS		=
else
src_rpm_fake_so_XSRCS		=  
src_rpm_fake_so_XLIBS		=  lib/libvserver.a
endif



src_EXTRA_PROGS			=  $(src_sbin_CXX_X_PROGS) $(src_pkglib_CXX_X_PROGS)

if ENSC_HAVE_CXX_COMPILER
src_sbin_CXX_PROGS		=  $(src_sbin_CXX_X_PROGS)
src_pkglib_CXX_PROGS		=  $(src_pkglib_CXX_X_PROGS)
else
src_sbin__PROGS			=
src_pkglib_CXX_PROGS		=  
endif

src/setattr$(EXEEXT):		src/showattr$(EXEEXT)
				@rm -f '$@'
				ln -s showattr$(EXEEXT) '$@'


## Local Variables:
## compile-command: "make -C .. -k"
## End:
