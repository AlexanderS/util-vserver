Summary:	Linux virtual server utilities
Name:		@PACKAGE@
Version:	@VERSION@
Release:	1
Epoch:		0
Copyright:	GPL
Group:		System Environment/Base
Source:		%name-%version.tar.bz2
Provides:	%name-devel = %epoch:%version-%release
BuildRoot:	%_tmppath/%name-%version-%release-root
Provides:	vserver = %epoch:%version-%release
Conflicts:	vserver < %epoch:%version


%description
This package provides the components and a framework to setup virtual
servers.  A virtual server runs inside a linux server. It is nevertheless
highly independent. As such, you can run various services with normal
configuration. The various vservers can't interact with each other and
can't interact with services in the main server.

This requires a special kernel supporting the new new_s_context and
set_ipv4root system call.


%prep
%setup -q


%build
%configure
%__make %{?_smp_mflags}


%install
rm -rf $RPM_BUILD_ROOT
%__make DESTDIR=$RPM_BUILD_ROOT install


%clean
rm -rf $RPM_BUILD_ROOT


%define v_services	httpd named portmap sendmail smb sshd xinetd
%post
/sbin/chkconfig --add vservers
/sbin/chkconfig --add rebootmgr

for i in %v_services; do
	/sbin/chkconfig --add v_$i
done


%preun
test "$1" != 0 || for i in %v_services; do
	/sbin/chkconfig --del v_$i
done

test "$1" != 0 || %{_initrddir}/rebootmgr stop &>/dev/null || :
test "$1" != 0 || /sbin/chkconfig --del rebootmgr
test "$1" != 0 || /sbin/chkconfig --del vservers


%postun
test "$1" = 0  || %{_initrddir}/rebootmgr condrestart >/dev/null || :


%files
%defattr(-,root,root)
%doc AUTHORS COPYING ChangeLog NEWS README THANKS
%doc doc/FAQ.txt
%_sbindir/*
%_libdir/%name
%_includedir/vserver.h
%_libdir/libvserver.a
%_mandir/man8/*
%config /etc/init.d/*
%config(noreplace) /etc/vservers/newvserver.defaults
%config(noreplace) /etc/vservers.conf


%changelog

* Fri Sep 26 2003 Enrico Scholz <enrico.scholz@informatik.tu-chemnitz.de> - 0:0.23.4-1
- initial build.
