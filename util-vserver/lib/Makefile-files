## $Id$  -*- makefile -*-

## Copyright (C) 2003 Enrico Scholz <enrico.scholz@informatik.tu-chemnitz.de>
##  
## This program is free software; you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation; either version 2, or (at your option)
## any later version.
##  
## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
##  
## You should have received a copy of the GNU General Public License
## along with this program; if not, write to the Free Software
## Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
##  

lib_VERSION =			0.0.0

lib_legacy_SRCS =		lib/getprocentry-legacy.c
lib_management_SRCS =		lib/getvserverbyctx.c \
				lib/getvservercfgstyle.c \
				lib/getvserverappdir.c \
				lib/getvservercfgdir.c \
				lib/getvserverctx.c \
				lib/getvservername.c \
				lib/getvservervdir.c
lib_v11_SRCS =			lib/syscall_rlimit.c \
				lib/syscall_kill.c
lib_v13_SRCS =			lib/syscall_getiattr.c \
				lib/syscall_setiattr.c \
				lib/syscall_gettaskxid.c \
				lib/syscall_getvxinfo.c
lib_fscompat_SRCS =  		lib/fscompat_setiattr.c \
				lib/fscompat_getiattr.c

PKGCONFIG_FILES =		lib/util-vserver

lib_SRCS =  			lib/syscall.c \
				lib/checkversion.c \
				lib/isdirectory.c \
				lib/getversion.c \
				lib/fmt-32.c \
				lib/fmt-64.c \
				lib/fmtx-32.c \
				lib/fmtx-64.c \
				lib/capabilities.c \
				$(lib_legacy_SRCS) \
				$(lib_management_SRCS) \
				$(lib_v11_SRCS) \
				$(lib_v13_SRCS) \
				$(lib_fscompat_SRCS)

lib_HDRS =			lib/vserver.h

lib_XHDRS =			lib/syscall-compat.hc \
	 			lib/syscall-legacy.hc \
				lib/syscall_rlimit-v11.hc \
				lib/syscall_kill-v11.hc \
				lib/syscall_getiattr-v13.hc \
				lib/syscall_setiattr-v13.hc \
				lib/syscall_gettaskxid-v13.hc \
				lib/syscall_gettaskxid-oldproc.hc \
				lib/syscall_getvxinfo-v13.hc \
				lib/syscall_getvxinfo-oldproc.hc \
				lib/fscompat_setiattr-v13.hc \
				lib/fscompat_setiattr-fscompat.hc \
				lib/fscompat_getiattr-v13.hc \
				lib/fscompat_getiattr-fscompat.hc \
				lib/getversion-internal.hc \
				lib/safechroot-internal.hc \
				lib/ioctl-getext2flags.hc \
				lib/ioctl-getfilecontext.hc \
				lib/ioctl-setext2flags.hc \
				lib/ioctl-setfilecontext.hc \
				lib/ioctl-getxflg.hc \
				lib/ioctl-setxflg.hc \
				lib/ext2fs.h \
				lib/fmt.h \
				lib/fmt.hc \
				lib/fmtx.hc \
				lib/fmt-internal.h \
				lib/virtual.h \
				lib/internal.h \
				lib/utils-legacy.h \
				lib/vserver-internal.h

#lib_lib_LIBS			=  lib/libvserver.a lib/libvserver-pic.a
lib_lib_LIBS			=
lib_lib_LTLIBS			=  lib/libvserver.la

#lib_libvserver_la_SOURCES	=  $(lib_SRCS)
#lib_libvserver_a_SOURCES	=  $(lib_SRCS)
#lib_libvserver_a_CPPFLAGS	=  $(AM_CPPFLAGS) $(LIB_DEBUG_CPPFLAGS) -I$(kernelincludedir) -D_REENTRANT -D_GNU_SOURCE
# _REENTRANT is needed for dietlibc to use __error_location

#lib_libvserver_pic_a_SOURCES	=  $(lib_SRCS)
#lib_libvserver_pic_a_CPPFLAGS	=  $(lib_libvserver_a_CPPFLAGS) -fPIC

lib_libvserver_la_SOURCES =  	$(lib_SRCS)
lib_libvserver_la_CPPFLAGS = 	$(AM_CPPFLAGS) $(LIB_DEBUG_CPPFLAGS) -I$(kernelincludedir) -D_REENTRANT -D_GNU_SOURCE
lib_libvserver_la_LDFLAGS =	-version $(lib_VERSION)

lib_DIETPROGS =			lib/lib_libvserver_la-% \
				lib/lib_libvserver_a-% \
				lib/lib_libvserver_pic_a-%
